Handlebars.registerHelper("ifObject",function(e,t){if(e&&e.constructor.name=="Object"){return t.fn(this)}else{return t.inverse(this)}});Handlebars.registerHelper("ifArray",function(e,t){if(e&&e.constructor.name=="Array"){return t.fn(this)}else{return t.inverse(this)}});var daysData=null,isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);$(function(){$(window).scroll(onScroll);$.stellar();if(isMobile){$(".header .twitter").show()}var e=Handlebars.compile($("#day-template").html()),t=[];daysData={3:{locations:"<span>Haarlem, Nederland</span> to <span>Stade, Deutschland</span>",campsite:{name:"Camping am Leuchtturm",url:"http://www.camping-krautsand.de",coordinates:[9.376723,53.759151],type:"Campsite"},photos:[[1,2],3,[4,5],6]},4:{locations:"<span>Stade, Deutschland</span> to <span>Horsens, Danmark</span>",campsite:{name:"Danhostel Horsens",url:"http://danhostelhorsens.dk",coordinates:[9.865806,55.873875],type:"Hostel"},photos:[1,2,3]},5:{locations:"<span>Horsens, Danmark</span> to <span>Feda, Norge</span>",campsite:{name:"Svindland Camping",url:"https://plus.google.com/111193542745148137265/about?gl=nl&hl=en",coordinates:[6.795964,58.281393],type:"Campsite"},photos:[1,[2,3],4,[{id:5,type:"portrait"},{id:6,type:"portrait"}],7,[8,9],10]},6:{locations:"<span>Feda, Norge</span> to <span>J&oslash;rpeland, Norge</span>",campsite:{name:"Preikestolen camping AS",url:"http://www.preikestolencamping.com",coordinates:[6.09251,58.99907],type:"Campsite"},photos:[1,2,3,4]},7:{locations:"<span>Preikestolen</span>",campsite:{name:"Preikestolen camping AS",url:"http://www.preikestolencamping.com",coordinates:[6.09251,58.99907],type:"Campsite"},photos:[1,[{id:2,type:"portrait"},{id:3,type:"portrait"}],4,5]},8:{locations:"<span>J&oslash;rpeland, Norge</span>",campsite:{name:"Preikestolen camping AS",url:"http://www.preikestolencamping.com",coordinates:[6.09251,58.99907],type:"Campsite"},photos:[1,[2,3],4,5,6,[{id:7,type:"portrait"},{id:8,type:"portrait"}],9,{id:10,type:"panorama"}]},9:{locations:"<span>J&oslash;rpeland, Norge</span> to <span>R&oslash;ldal, Norge</span>",campsite:{name:"RÃ¸ldal Hyttegrend",url:"http://www.roldal-camping.no",coordinates:[6.827082,59.831163],type:"Cabin"},photos:[1,[2,3],4,[{id:5,type:"portrait"},{id:6,type:"portrait"}]]},10:{locations:"<span>R&oslash;ldal, Norge</span> to <span>Ulvik, Norge</span>",campsite:{name:"Espelandsdalen Camping",url:"http://www.espelandsdalencamping.no",coordinates:[6.806182,60.59339],type:"Campsite"},photos:[1,[2,3],{id:4,type:"panorama"},5,[6,7],8,[{id:9,type:"portrait"},{id:10,type:"portrait"}],11,[12,13]]},11:{locations:"<span>Ulvik, Norge</span> to <span>Reed, Norge</span>",campsite:{name:"Reed camping og fritid",url:"http://www.reed-camping.no",coordinates:[6.408108,61.731635],type:"Cabin"},photos:[1,2,[3,4],5]},12:{locations:"<span>Reed, Norge</span> to <span>Geiranger, Norge</span> and back",campsite:{name:"Reed camping og fritid",url:"http://www.reed-camping.no",coordinates:[6.408108,61.731635],type:"Cabin"},photos:[1,[2,3],4,[5,6],7,[8,9],10,[11,12],[13,14],15,16]},13:{locations:"<span>Geiranger, Norge</span> to <span>Vikersund, Norge</span>",campsite:{name:"Natvedt Camping",coordinates:[10.020385,59.977108],type:"Campsite"},photos:[1,2]},14:{locations:"<span>Vikersund, Norge</span> to <span>Kristiansand, Norge</span>",campsite:{name:"Yess Hotel",url:"http://www.yesshotel.no",coordinates:[7.987935,58.147536],type:"Hotel"},photos:[[{id:1,type:"portrait"},{id:2,type:"portrait"}]]},15:{locations:"<span>Kristiansand, Norge</span> to <span>Horsens, Danmark</span>",campsite:{name:"Danhostel Horsens",url:"http://danhostelhorsens.dk",coordinates:[9.865806,55.873875],type:"Hostel"},photos:[[{id:1,type:"portrait"},{id:3,type:"portrait"}],[{id:2,type:"portrait"},{id:4,type:"portrait"}]]},16:{locations:"<span>Horsens, Danmark</span> to <span>Haarlem, Nederland</span>",photos:[[1,2]]}};downloadRides(function(n){$.each(n,function(n,r){var i=new Date(Date.parse(r.a)),s=i.getDate(),o="th";if(s==3){o="rd"}$("#days").append(e({i:n,date:s,showMap:s!=7,day:"September "+s+o,locations:daysData[s]["locations"],photos:daysData[s]["photos"],text:daysData[s]["text"],distance:Math.round(r.d)}));if(s!=7){var u=[];$.each(r["r"],function(e,n){u.push([n[0],n[1]]);t.push([n[0],n[1]])});addMap(n,u)}});$(".days-loading").hide();addMap("entire",t);initScroll();$(window).resize(function(){doScroll=true;initScroll()})});var n=false;$("#stats h3 span").click(function(){if($(this).hasClass("active")){return}$("#stats h3 span.active").removeClass("active");$(this).addClass("active");var e=$(this).text();$("#stats td").each(function(){if(e=="EUR"){if($(this).data("eur")){$(this).html($(this).data("eur"))}}else{if(!n){$(this).data("eur",$(this).html())}if($(this).data("us")){$(this).html($(this).data("us"))}if(e=="UK"&&$(this).data("uk")){$(this).html($(this).data("uk"))}}});if(e!="EUR"){n=true}})});var addMap=function(e,t){var n=L.map("map-"+e).setView(L.latLng(t[0][1],t[0][0]),13);n.fitBounds(t);n.touchZoom.disable();n.scrollWheelZoom.disable();n.boxZoom.disable();n.keyboard.disable();if(isMobile){n.dragging.disable();L.DomEvent.preventDefault=function(e){return};$(".leaflet-control-zoom").css("visibility","hidden")}L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{maxZoom:18,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(n);var r={type:"LineString",coordinates:t};var i={color:"#e10b29",weight:5,opacity:.65};var r=L.geoJson(r,{style:i}).addTo(n);n.fitBounds(r.getBounds(),{padding:[20,20]});var s=[[4.675147,52.370315],[6.135114,53.096171],[8.136318,53.392021],[9.89013,53.517543],[9.368177,54.856684],[10.134652,56.311327],[7.658268,58.270003],[6.854821,58.907425],[6.035088,59.026138],[6.271206,59.48057],[6.546278,60.066216],[7.211042,60.898841],[6.614652,61.851775],[7.205144,62.102651],[7.118485,61.232601],[9.462802,60.430026],[10.208233,59.17758],[10.041954,57.455879],[9.786374,55.886424],[9.670703,54.364367],[8.70352,53.011772],[6.861547,52.286466]];if(e=="entire"){var o=[];$(s).each(function(e,t){o.push({type:"Feature",properties:{popupContent:"Fuel Station"},geometry:{type:"Point",coordinates:t}})});var u={radius:6,fillColor:"#000",color:"#000",weight:1,opacity:.65,fillOpacity:.65};var a=L.geoJson(o,{pointToLayer:function(e,t){return L.circleMarker(t,u)},onEachFeature:function(e,t){if(e.properties&&e.properties.popupContent){t.bindPopup(e.properties.popupContent)}}}).addTo(n);o=[];var f=false;for(var l in daysData){var c=daysData[l];if(c.campsite){if(c.campsite.name.match("Danhostel")){if(f){continue}f=true}o.push({type:"Feature",properties:{popupContent:'<a href="'+c.campsite.url+'">'+c.campsite.name+"</a>"},geometry:{type:"Point",coordinates:c.campsite.coordinates}})}}var h={radius:6,fillColor:"green",color:"green",weight:1,opacity:.65,fillOpacity:.65};L.geoJson(o,{pointToLayer:function(e,t){return L.circleMarker(t,h)},onEachFeature:function(e,t){if(e.properties&&e.properties.popupContent){t.bindPopup(e.properties.popupContent)}}}).addTo(n)}};var downloadRides=function(e){$.ajax({xhr:function(){var e=new window.XMLHttpRequest;return e},url:"resources/json/days.json",success:function(t){e(t)}})};var initedScroll=false,doScroll=false,loadedMap,imageIds,imagePositionsArray,imageMap,windowHeight,headerHeight,clonedHeader;var initScroll=function(){imagePositionsArray=[];imageMap={};loadedMap=[];imageIds=[];headerPositions=[];windowHeight=$(window).height();headerHeight=$(".header").height();var e=0;$("img.lazy").each(function(){$(this).attr("id","image-"+e);imageIds.push("image-"+e);var t=Math.round($(this).offset().top);if(imageMap[t]){imageMap[t].push("image-"+e)}else{imageMap[t]=["image-"+e]}if(imagePositionsArray.indexOf(t)==-1){imagePositionsArray.push(t)}e++});initedScroll=true;if(doScroll){onScroll()}};var onScroll=function(){if(!initedScroll){doScroll=true;return}var e=window.scrollY,t=600,n=1e3,r,i,s=[],o=imageIds.slice(0);r=Math.round(e-windowHeight);i=Math.round(Math.min(r+windowHeight*2+t,imagePositionsArray[imagePositionsArray.length-1]+1));for(var u=r;u<i;u++){if(!imageMap[u]){continue}for(var a=0;a<imageMap[u].length;a++){s.push(imageMap[u][a]);var f=o.indexOf(imageMap[u][a]);if(f!=-1){o.splice(f,1)}}}for(var u=0;u<s.length;u++){loadImage(s[u])}for(var u=0;u<o.length;u++){unloadImage(o[u])}if(isMobile){return}if(e>headerHeight-60){if(!clonedHeader){$(".header .twitter").hide();clonedHeader=$(".header").clone();clonedHeader.addClass("sticky");clonedHeader.children("h1").remove();clonedHeader.append("<h2>Norway<span>September 2014</span></h2>");clonedHeader.children("h2").hide();$("body").append(clonedHeader);$(".header.sticky .twitter").show();clonedHeader.children("h2").fadeIn()}}else if(clonedHeader){$(".header .twitter").show();$(".header.sticky .twitter").hide();clonedHeader.css("background-image","none");clonedHeader.fadeOut(function(){clonedHeader.remove();clonedHeader=null})}};var loadImage=function(e){if(loadedMap.indexOf(e)!=-1){return}loadedMap.push(e);var t=document.getElementById(e);t.setAttribute("src",t.getAttribute(isMobile?"data-small":"data-original"))};var unloadImage=function(e){var t=loadedMap.indexOf(e);if(t==-1){return}loadedMap.splice(t,1);var n=document.getElementById(e);n.setAttribute("src",n.getAttribute("data-spacer"))}